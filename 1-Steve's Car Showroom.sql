use master 

---create database--
create database Steves_Car_Showroom 
go

---use created database--
use Steves_Car_Showroom 
go

---create CARS table--

CREATE TABLE cars 
(
car_id    INT     PRIMARY KEY,
make      VARCHAR(50),
type      VARCHAR(50),
style     VARCHAR(50),
cost_$    INT
)
go
-- see the table--

select * from cars
go

--- insert data in to CARES table--

INSERT INTO cars VALUES 

(1, 'Honda',      'Civic',     'Sedan',     30000),
(2, 'Toyota',     'Corolla',   'Hatchback', 25000),
(3, 'Ford',       'Explorer',  'SUV',       40000),
(4, 'Chevrolet',  'Camaro',    'Coupe',     36000),
(5, 'BMW',          'X5',      'SUV',       55000),
(6, 'Audi',         'A4',     'Sedan',      48000),
(7, 'Mercedes',   'C-Class',  'Coupe',      60000),
(8, 'Nissan',     'Altima',   'Sedan',      26000)
go

---see the insert data--
select * from cars
go

--to create salespersons table--

CREATE TABLE salespersons 
(
salesman_id   INT      PRIMARY KEY,
Name          VARCHAR(50),
age           INT,
city          VARCHAR(50)
) 
go

--see the table--

select * from salespersons
go

--insert data into salespersons table--

INSERT INTO salespersons (salesman_id, name, age, city)
VALUES 
(1, 'John Smith', 28, 'New York'),
(2, 'Emily Wong', 35, 'San Fran'),
(3, 'Tom Lee',    42, 'Seattle'),
(4, 'Lucy Chen',  31, 'LA');

go

--to see the insert data--

select * from salespersons
go

--to create the sales table--

CREATE TABLE sales (
sale_id       INT    PRIMARY KEY,
car_id        INT,
salesman_id   INT,
FOREIGN KEY (car_id)  REFERENCES cars(car_id),
FOREIGN KEY (salesman_id) REFERENCES salespersons(salesman_id),
purchase_date DATE,
)
go

--see the table---

select * from sales
go
---insert data into sales table--

INSERT INTO sales VALUES 
(1, 1, 1, '2021-01-01'),
(2, 3, 3, '2021-02-03'),
(3, 2, 2, '2021-02-10'),
(4, 5, 4, '2021-03-01'),
(5, 8, 1, '2021-04-02'),
(6, 2, 1, '2021-05-05'),
(7, 4, 2, '2021-06-07'),
(8, 5, 3, '2021-07-09'),
(9, 2, 4, '2022-01-01'),
(10, 1, 3, '2022-02-03'),
(11, 8, 2, '2022-02-10'),
(12, 7, 2, '2022-03-01'),
(13, 5, 3, '2022-04-02'),
(14, 3, 1, '2022-05-05'),
(15, 5, 4, '2022-06-07'),
(16, 1, 2, '2022-07-09'),
(17, 2, 3, '2023-01-01'),
(18, 6, 3, '2023-02-03'),
(19, 7, 1, '2023-02-10'),
(20, 4, 4, '2023-03-01')
go

--- see the insert data--

select * from sales
go

---Answer the following questions--

--1. What are the details of all cars purchased in the year 2022?

select* from sales
where purchase_date between '2022-01-01' and'2022-12-31'
go


---2. What is the total number of cars sold by each salesperson?--

SELECT s.name AS Salesperson, COUNT(*) AS TotalCarsSold
FROM salespersons s
JOIN sales sa ON s.salesman_id = sa.salesman_id
GROUP BY s.name;

----- 3. What is the total revenue generated by each salesperson?--

SELECT sp.name AS Salesperson, SUM(c.cost_$) AS TotalRevenue
FROM salespersons sp
JOIN sales s ON sp.salesman_id = s.salesman_id
JOIN cars c ON s.car_id = c.car_id
GROUP BY sp.name;


---- 4. What are the details of the cars sold by each salesperson?---

SELECT s.name AS Salesperson, c.*
FROM salespersons s
JOIN sales sa ON s.salesman_id = sa.salesman_id
JOIN cars c ON sa.car_id = c.car_id;

----5. What is the total revenue generated by each car type?--

SELECT c.type AS CarType, SUM(c.cost_$) AS TotalRevenue
FROM cars c
JOIN sales sa ON c.car_id = sa.car_id
GROUP BY c.type;

---6. What are the details of the cars sold in the year 2021 by salesperson 'Emily Wong'?--

SELECT c.*
FROM cars c
JOIN sales sa ON c.car_id = sa.car_id
JOIN salespersons s ON sa.salesman_id = s.salesman_id
WHERE s.name = 'Emily Wong' AND sa.purchase_date >= '2021-01-01' AND sa.purchase_date <= '2021-12-31';

----7. What is the total revenue generated by the sales of hatchback cars?--

SELECT SUM(c.cost_$) AS TotalRevenue
FROM cars c
JOIN sales sa ON c.car_id = sa.car_id
WHERE c.type = 'Hatchback';

----8. What is the total revenue generated by the sales of SUV cars in the year 2022?--

SELECT SUM(c.cost_$) AS TotalRevenue
FROM cars c
JOIN sales sa ON c.car_id = sa.car_id
WHERE c.type = 'SUV' AND YEAR(sa.purchase_date) = 2022;

---9. What is the name and city of the salesperson who sold the most number of cars in the year 2023?---

SELECT TOP 1 sp.name AS SalespersonName, sp.city AS City
FROM salespersons sp
JOIN sales s ON sp.salesman_id = s.salesman_id
WHERE YEAR(s.purchase_date) = 2023
GROUP BY sp.name, sp.city
ORDER BY COUNT(*) DESC;



-----10. What is the name and age of the salesperson who generated the highest revenue in the year 2022?---

SELECT TOP 1 sp.name AS SalespersonName, sp.age AS Age
FROM salespersons sp
JOIN sales s ON sp.salesman_id = s.salesman_id
JOIN cars c ON s.car_id = c.car_id
WHERE YEAR(s.purchase_date) = 2022
GROUP BY sp.name, sp.age
ORDER BY SUM(c.cost_$) DESC;

